<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="statut-servers-list">

    </div>
</body>
<script>
    const serveursFetch = () => {
    const serverContainer = document.getElementById('statut-servers-list');
    serverContainer.innerHTML = "";
    fetch('https://api.mineaurion.com/query')
      .then( response => {
        response.json()
          .then( servers => {
            let index = 0;
            let id = index;
            servers.forEach( server => {
              const css = server.status ? "green" : "red";
              const stateServer = server.status ? "Allumé" : "Éteint";
              let playersList = "";
                id = index;
                html = '<div class="statut-server" id="'+ id + '"></div>'
                serverContainer.innerHTML += html;
              server.players.forEach( player => {
                playersList += '<a class="playerhead" title="'+ player +'"><img src="https://cravatar.eu/avatar/'+ player +'/30"/></a>';
              })
              let badge = " ";
              if(server.access.beta){
                badge += '<span class="badge">Beta</span>'
              }
              if(server.access.paying){
                badge += '<a href="shop.mineaurion.com class="badge" ">Payant</a>'
              }
              if(server.access.donator){
                badge += '<a href="shop.mineaurion.com class="badge" ">Donateur</a>'
              }
              html =  ['<div class="statut-server-title">'+ server.name + badge + '</div>',
                        '<div class="statut-server-infos">',
                            '<p>Adresse : '+ server.dns +'</p>',
                            '<p>Version : '+ server.version.modpack +'</p>',
                            '<p>Joueur(s) : '+ server.onlinePlayers +'/'+ server.maxPlayers +'</p>',
                            '<p>Statut : <span class="'+ css +'">'+ stateServer +'</span></p>',
                            '<p>Joueur(s) en ligne : </p>' + playersList + '</div>'];
              document.getElementById(id).innerHTML += html.join('');
              index++;
            })
          })
          .catch( error => console.error("Api doesn't send a json", error))
      })
      .catch( error => console.error("Error when fetching the server", error))
  }
  
  document.addEventListener('DOMContentLoaded', (event) => {
    serveursFetch();
    setInterval(function () {
        console.log(serveursFetch());
    }, 50000);
  })
</script>
</html>